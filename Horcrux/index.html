<!DOCTYPE html>
<html  >
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v5.6.13, mobirise.com">
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image:src" content="">
  <meta property="og:image" content="">
  <meta name="twitter:title" content="Home">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/logo5.png" type="image/x-icon">
  <meta name="description" content="">
  
  
  <title>Home</title>
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  
  
  
  
</head>
<body>
  
  <section data-bs-version="5.1" class="content4 cid-tgsGDt7A1z" id="content4-0">
    

    
    <div class="mbr-overlay" style="opacity: 0.7; background-color: rgb(255, 255, 255);">
    </div>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="title col-md-12 col-lg-10">
                <h3 class="mbr-section-title mbr-fonts-style align-center mb-4 display-2"><strong>Horcrux.</strong><br><strong>С чем его едят?</strong><strong><br></strong></h3>
                <h4 class="mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5">Или разворачиваем валидатора тестнета HAQQ в кластере.</h4>
                
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgsPfV6aRw" id="content5-2">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-7">
                    Салют!
                </h4>
                <p class="mbr-text mbr-fonts-style display-4">Поскольку это моя первая статься/гайд на тематику развертывания нод, критика не принимается :D
<br>На днях, коллега по цеху выкатил статью о развертывании нод по средствам <a href="https://teletype.in/@beething/obiWlwK-PcM" class="text-primary" target="_blank">kubernetes</a>&nbsp;(в каком-то смысле - дублирование онных). После кучи вопросов и последующего продолжительного ликбеза, пришел к скромному выводу: что ж, если вы уже "серьезный дядя" в мире мэйннетов, такой подход имеет место быть. Однако, у данной технологии высокий порог входа, так же есть свои + и - . <br>Данная дискуссия напомнила мне о давно возникавшем желании реализовать нативную кластеризацию валидатора. Чем мы сегодня и займемся =) <br>На испытательном полигоне выступят <a href="https://github.com/strangelove-ventures/horcrux" class="text-primary" target="_blank">Horcrux</a> (сервис <a href="https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB_%D0%BA%D0%BE%D0%BD%D1%84%D0%B8%D0%B4%D0%B5%D0%BD%D1%86%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE_%D0%B2%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F" class="text-primary" target="_blank">защищенных многосторонних вычислений</a> для подписания нод Tendermint) и проект <a href="https://islamiccoin.net" class="text-primary" target="_blank">Islamic Coin</a> .</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content7 cid-tgsPgT5CeP" id="content7-3">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-9">
                <blockquote>
                
                <p class="mbr-text mbr-fonts-style display-4">Данный материал так же требует определенного понимания что такое ноды, блокчейны и все такое по этой кухне. Предполагается, что читателем давно пройдена стадия "друг соседа сказал шо там кнопка &lt;БАБЛО&gt;", и уровень сознания со скилами, как минимум, "энтузиаст+"&nbsp; &nbsp;=)</p></blockquote>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgATPQOvOb" id="content5-5">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Собственно, чем полезен данный сервис? Horcrux - это "мультиподписант" для нод Tendermint, который позволяет:
<br>а) поднять кластер из 2+n нод для лучшего High Availability, за счет отказоустойчивости (единственный минус - аренда всего этого 2+n хозяйства)<br>б) защитить ключ, за счет разбиения его на части (скомпрометировав одну из частей, жулик соснет тунца)
<br>Можно настраивать порог количества частей ключа, имеющих силу подписи: 2 из 3, 3 из 5, 4 из 7. В подробности углубляться не буду. Для <a href="https://github.com/strangelove-ventures/horcrux/blob/main/docs/signing.md" class="text-primary" target="_blank">пытливых умов</a>.<br>Короче говоря, это уже следующий уровень инфраструктуры валидатора.&nbsp;<br>
<br>Прежде чем приступить к переносу действующего валидатора в кластер, я подготовил 3 синхронизированные ноды на разных серверах. Можно было бы, конечно, заморочиться с построением приватной сети, как то предлагает оф.документация:<br></p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="image1 cid-tgAW1rOs1F" id="image1-9">
    

    
    

    <div class="container">
        <div class="row align-items-center">
            <div class="col-12 col-lg-7">
                <div class="image-wrapper" margin>
                    <img src="assets/images/example-network-816x496.png" alt="img">
                    
                </div>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgATQvh3rx" id="content5-6">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">однако, это тестнет, а у нас задача познакомиться с данной технологией. Соответственно, позволю себе, в каком-то смысле, пренебречь безопасностью и каждую часть подписанта подселю к своей ноде на сервер. В мэйннете, конечно же, лучше действовать по фен-шую.<br>Ставим сервис (<a href="https://github.com/strangelove-ventures/horcrux/releases" class="text-primary" target="_blank">проверить релиз</a>):</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgATR2Ym5o" id="content5-7">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">wget https://github.com/strangelove-ventures/horcrux/releases/download/v2.0.0/horcrux_2.0.0_linux_amd64.tar.gz
<br>tar -xzf horcrux_2.0.0_linux_amd64.tar.gz
<br>mv horcrux /usr/bin/horcrux &amp;&amp; rm horcrux_2.0.0_linux_amd64.tar.gz README.md LICENSE.md</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB2QkM6ZO" id="content5-a">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Создаем сервис:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB3gnOSjS" id="content5-c">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">tee /etc/systemd/system/horcrux.service &gt; /dev/null &lt;&lt;EOF<br>[Unit]
<br>Description=MPC Signer node
<br>After=network.target
<br>[Service]
<br>Type=simple
<br>User=root
<br>ExecStart=/usr/bin/horcrux cosigner start
<br>Restart=always<br>RestartSec=3
<br>LimitNOFILE=4096
<br>[Install]
<br>WantedBy=multi-user.target<br>EOF<br><br>systemctl daemon-reload<br>systemctl enable&nbsp;horcrux<br></p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB4XTJIx0" id="content5-d">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Инициализируем конфигурацию на каждом сервере для своей же ноды. Для каждого сервера своя команда:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB4Z8Tz4O" id="content5-e">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4"># подписант-1 будет коннектиться к ноде c ID-1<br>horcrux config init haqq_53211-1 "tcp://127.0.0.1:1234" -c -p "tcp://10.168.1.2:2222|2,tcp://10.168.1.3:2222|3" -l "tcp://10.168.1.1:2222" -t 2 --timeout 1500ms
<br><br># подписант-2 будет коннектиться к ноде c ID-2<br>horcrux config init haqq_53211-1 "tcp://127.0.0.1:1234" -c -p "tcp://10.168.1.1:2222|1,tcp://10.168.1.3:2222|3" -l "tcp://10.168.1.2:2222" -t 2 --timeout 1500ms
<br><br># подписант-3 будет коннектиться к ноде c ID-3<br>horcrux config init haqq_53211-1 "tcp://127.0.0.1:1234" -c -p "tcp://10.168.1.1:2222|1,tcp://10.168.1.2:2222|2" -l "tcp://10.168.1.3:2222" -t 2 --timeout 1500ms</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB2S594UO" id="content5-b">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">На каждой ноде включаем приемник валидатора:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB9aWQAWo" id="content5-f">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">sed -i 's#priv_validator_laddr = ""#priv_validator_laddr = "tcp://127.0.0.1:1234"#g' $HOME/.haqqd/config/config.toml<br><br>systemctl restart haqqd &amp;&amp; journalctl -u haqqd -f&nbsp;<br></p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB9cSiD8U" id="content5-g">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Далее с действующего валидатора ручками скачиваем&nbsp;priv_validator_key.json, заливаем в $HOME/.horcrux/ на любой из серверов (для удобства на 1) и режем на 3 части:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB9e6G53b" id="content5-h">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">cd .horcrux<br>horcrux create-shares priv_validator_key.json 2 3</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB9eSOsva" id="content5-i">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">На выходе 3 части:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB9frMZK0" id="content5-j">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">ls
<br>priv_validator_key.json
<br>private_share_1.json
<br>private_share_2.json
<br>private_share_3.json</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgB9fZWGxH" id="content5-k">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Первую часть переименовываем в&nbsp;share.json и оставляем на месте&nbsp;в $HOME/.horcrux/ , остальные две части скачиваем себе на компьютер, так же переименовываем в share.json и заливаем на каждый сервер,&nbsp;в такой же каталог, в соответствии с ID. То есть сопоставляем:<br>private_share_1.json =  ID-1 =&gt; $HOME/.horcrux/share.json<br>private_share_2.json = ID-2 =&gt; $HOME/.horcrux/share.json<br>private_share_3.json = ID-3 =&gt; $HOME/.horcrux/share.json<br>На будущее, внутри каждой части ключа, в конце контекста присутствует ID.<br><br>Далее самое интересное. Что бы валидатор не попал в тюрьму, делать надо все внимательно и не считать мух. И все же, будьте готовы в любой момент апнуть валидатора, если что-то пойдет по стекловате..<br>Стопаем действующего валидатора, открываем файл&nbsp;$HOME/.haqqd/data/priv_validator_state.json , в нем содержится информация о последней подписи действовашим валидатором:<br></p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgBjNtne5D" id="content5-l">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">{
<br>  "height": "361402",
<br>  "round": 0,
<br>  "step": 3,
<br>  "signature": "IEOS7EJ8C6ZZxwwXiGeMhoO8mwtgTiq6VPR/F1cpLZuz0ZvUZdsgQjTt0GniAIgosfEjC5izKw4Nvvs3ZIceAw==",
<br>  "signbytes": "6B080211BA8305000000000022480A205D4E1F722F53A3FD9E0D28639D7CE7B588338570EBA5C340687C30609C47BCA41224080112208283B6E16BEA46797F8AD4EE0ACE424AC7A4827202446B2D56E7F4438541B7BD2A0C08E4ACE28B0610CCD0AC830232066A756E6F2D31"
<br>}</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgBjPyIRXY" id="content5-m">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Копируем поля:<br><br>&nbsp; "height": "361402",
<br>&nbsp; "round": 0,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(значение этого поля оборачиваем в кавычки ! )<br>&nbsp; "step": 3,<br><br>и вставляем на каждой подготовленной ноде в оба файла (что бы валидатор завелся с того же места)<br> $HOME/.horcrux/state/haqq_53211-1_priv_validator_state.json<br> $HOME/.horcrux/state/haqq_53211-1_share_sign_state.json<br><br>Должно получиться:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgBjQolnA2" id="content5-n">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">{
<br>"height": "361402",
<br>"round": "0",
<br>"step": 3,
<br>"ephemeral_public": null<br>}</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgBjRd26SE" id="content5-o">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-4">Сохраняем и:</p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgBjRRwnWT" id="content5-p">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">systemctl start  horcrux &amp;&amp; journalctl -u horcrux -f&nbsp;<br></p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content5 cid-tgBpwciArw" id="content5-q">
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                
                <p class="mbr-text mbr-fonts-style display-7">Поздравляю! Господа мамкины хацкеры, у вас лэвэл ап =)<br>Не забудьте настроить fw, что бы ноды по порту 2222 общались только друг с другом.<br>Повторюсь, этот гайд для ознакомления с технологией. Хотя, как по мне, он получился более юзерфрэндли, нежели оф.документация. Но для более детального погружения покурить её все же стоит.<br><br>За сим откланиваюсь. Всегда ваш...<br><br></p>
            </div>
        </div>
    </div>
</section>

<section data-bs-version="5.1" class="content15 cid-tgBs9ZRjzV" id="content15-r">

    

    
    
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="card col-md-12 col-lg-12">
                <div class="card-wrapper">
                    <div class="card-box align-left">
                        
                        <p class="mbr-text mbr-fonts-style display-5"><a href="http://stake.broker" class="text-white" target="_blank">StakeBroker</a> | <a href="https://www.nodesblocks.dev/" class="text-white" target="_blank">NodesBlocks team</a>&nbsp;| <a href="https://discord.gg/Mtp2c9BAJN" class="text-white">team Discord server</a><br><a href="tg://resolve?domain=stakebroker" class="text-white text-primary">@StakeBroker</a>&nbsp;| <a href="https://discordapp.com/users/966770759261376603/" class="text-white" target="_blank">Alexneshko#</a></p>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
  
  
</body>
</html>